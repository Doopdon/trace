class Wrapper{addChild(e){this.childWrappers.push(e)}removeChild(e){this.childWrappers=this.childWrappers.filter(r=>r!==e)}}class ElementWrapper extends Wrapper{constructor(e){super(),this.renderFunction=e,this.childWrappers=[],this.type="single"}update(){return this.parentWrapper.removeChild(this),this.render(this.$parent,this.parentWrapper),document.contains(this.$parent)}render(e,r){this.$parent=e,this.parentWrapper=r,r&&r.addChild(this);let t=this.renderFunction(e,this);return this.$element?(e.insertBefore(t,this.$element),e.removeChild(this.$element)):e.appendChild(t),this.$element=t}}class ElementWrapperList extends Wrapper{constructor(e,r){super(),this.renderFunction=e,this.__initialChildWrappers=r.map(r=>r.display(e)),this.childWrappers=[],this.type="list"}get(){}__getFooterElement(){let e,r=!1;return this.parentWrapper.childWrappers.find(t=>r?!!(e=t.$element):(t===this&&(r=!0),!1)),e}get $element(){return this.childWrappers[0]&&this.childWrappers[0].$element||this.__getFooterElement()}insertAt(e,r){let t=this.childWrappers[e]&&this.childWrappers[e].$element||this.__getFooterElement(),s=r.display(this.renderFunction).render(this.$parent,this);this.childWrappers.splice(e,0,this.childWrappers.pop()),t&&this.$parent.insertBefore(s,t)||this.$parent.appendChild(s)}deleteAt(e){let r=this.childWrappers[e]&&this.childWrappers[e].$element;this.childWrappers.splice(e,1),this.$parent.removeChild(r)}move(e,r){var t=this.childWrappers[e];this.$parent.appendChild(t.$element),this.$parent.insertBefore(t.$element,this.childWrappers[r].$element),this.childWrappers.splice(e,1),this.childWrappers.splice(r,0,t)}render(e,r){this.$parent=e,this.parentWrapper=r,r&&r.addChild(this),this.__initialChildWrappers.forEach(r=>r.render(e,this))}}class Prop{}class RenderProp extends Prop{constructor(e){super(),this.value=e,this.wrappers=[]}set(e){this.value=e,this.wrappers=this.wrappers.filter(e=>e.update())}get(){return this.value}display(e){let r=new ElementWrapper((r,t)=>e(this.value,this).render(r,t));return this.wrappers.push(r),r}}class RenderListProp extends RenderProp{constructor(e,r){super(e),this.parentRenderList=r}delete(){this.parentRenderList.deleteAt(this.getIndex())}move(e){this.parentRenderList.move(this.getIndex(),e)}getIndex(){let e;return this.parentRenderList.renderProps.find((r,t)=>r===this&&(e=t)),e}}class RenderList extends Prop{constructor(e){super(),this.renderProps=e.map(e=>new RenderListProp(e,this)),this.listWrappers=[]}get value(){return this.renderProps.map(e=>e.value)}display(e){let r=new ElementWrapperList(e,this.renderProps);return this.listWrappers.push(r),r}append(){}prepend(){}insertAt(e,r){let t=new RenderListProp(r,this);this.listWrappers.forEach(r=>r.insertAt(e,t)),this.renderProps.splice(e,0,t)}pop(){}shift(){}deleteAt(e){this.listWrappers.forEach(r=>r.deleteAt(e));let r=this.renderProps[e].get();return this.renderProps.splice(e,1),r}move(e,r){console.warn("need to add source, dest index bounds checks");var t=this.renderProps[e];this.renderProps.splice(e,1),this.renderProps.splice(r,0,t),this.listWrappers.forEach(t=>t.move(e,r))}sortOn(){}sort(e){e=e||function(e,r){if(e===r)return 0;if(t(e))return t(r)?e-r:-1;return t(r)?1:e>r?1:-1;function t(e){return"number"==typeof e||!isNaN(e)}},this.renderProps.sort((r,t)=>e(r.get(),t.get(),r,t)),this.listWrappers.forEach((e,r)=>{var t=[];let s;this.renderProps.forEach((i,p)=>{i=this.renderProps[this.renderProps.length-(p+1)],s=s||e.childWrappers[0].$element,e.$parent.insertBefore(i.wrappers[r].$element,s),s=i.wrappers[r].$element,t.unshift(i.wrappers[r])}),e.childWrappers=t})}}function generateElement(e,r,t){var s=t&&r,i=t||r;return new ElementWrapper(function(r,t){let p=document.createElement(e);return i&&function e(r){return r instanceof Array?r.forEach(r=>e(r)):r instanceof Wrapper?r.render(p,t):r instanceof Element?p.appendChild(r):void(p.innerHTML+=r.toString())}(i),s&&function(e){Object.keys(e).forEach(r=>{"function"==typeof e[r]?p[r]=e[r]:p.attributes(r,e[r])})}(s),p})}"a,abbr,acronym,address,applet,area,article,aside,audio,b,base,basefont,bb,bdo,big,blockquote,body,br,button,canvas,caption,center,cite,code,col,colgroup,command,datagrid,datalist,dd,del,details,dfn,dialog,dir,div,dl,dt,em,embed,eventsource,fieldset,figcaption,figure,font,footer,form,frame,frameset,h1,h2,h3,h4,h5,h6,head,header,hgroup,hr,html,i,iframe,img,input,ins,isindex,kbd,keygen,label,legend,li,link,map,mark,menu,meta,meter,nav,noframes,noscript,object,ol,optgroup,option,output,p,param,pre,progress,q,rp,rt,ruby,s,samp,script,section,select,small,source,span,strike,strong,style,sub,sup,table,tbody,td,textarea,tfoot,th,thead,time,title,tr,track,tt,u,ul,var,video,wbr".split(",").forEach(e=>window[e]=((r,t)=>generateElement(e,r,t)));